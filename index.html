<!DOCTYPE html>
<html lang="it">

    <head>
    <script src="https://openporte2025.github.io/shared-database/opzioni-comuni.js"></script>
    <script src="https://openporte2025.github.io/shared-database/data-manager.js"></script>
    <script src="https://openporte2025.github.io/shared-database/github-sync.js"></script>
    <script src="https://openporte2025.github.io/shared-database/editor-posizione.js"></script>
    <script src="https://openporte2025.github.io/shared-database/project-manager.js"></script>
    <script src="js/database-configurazioni.js"></script>    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=3.0, user-scalable=yes">
    
    <!-- Anti-cache per GitHub Pages -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">F
    
    <title>Dashboard Rilievi v8.500</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/main.css">
    
    <!-- Librerie esterne -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Configurazione -->
    <script src="js/config.js"></script>
    
    <!-- Database -->
    <script src="js/database/maniglie-finstral.js"></script>
    <script src="js/database/ferrerolegno.js"></script>
    <script src="js/database/olivari.js"></script>
    <script src="js/database/colombo.js"></script>
    <script src="js/database/flessya.js"></script>
    <script src="js/database/listini-extra.js"></script>
    <script src="js/database/finstral.js"></script>
    <script src="js/database/somfy.js"></script>
    <script src="js/database/palagina.js"></script>
    <script src="js/database/sconti.js"></script>
    <script src="js/database/gibus.js"></script>
    <script src="js/database/plasticino.js"></script>
    <script src="js/database/persiane.js"></script>
    <script src="js/database/oikos.js"></script>
    <script src="js/database/costi-lavoro.js"></script>
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="header-content">
            <!-- MENU TOGGLE HAMBURGER -->
            <button class="menu-toggle" onclick="toggleMenu()" aria-label="Toggle Menu">
                ‚ò∞
            </button>
            
            <div class="logo">
                Dashboard Rilievi 
                <span class="logo-version" id="version-badge">v8.500</span>
                <span class="logo-subtitle">- Calcolo Completo</span>
            </div>
            <nav class="main-nav">
                <button class="nav-btn active blocco-ufficio" onclick="switchBlocco('ufficio')">
                    üíº Ufficio
                </button>
                <button class="nav-btn blocco-posa" onclick="apriPosaApp()" title="Apri App Posa in nuova finestra">
                    üîß Apri App Posa
                </button>
                
                <!-- PULSANTE CONFERMA CLIENTE -->
                <button class="nav-btn blocco-conferma" id="btn-conferma-cliente" onclick="apriConfermaCliente()" 
                        style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; font-weight: 700;" 
                        title="Genera documento conferma per il cliente"
                        disabled>
                    üìã Conferma Cliente
                </button>
            </nav>
        </div>
        
    </header>

    <!-- MENU LATERALE -->
    <div id="sidebarMenu" class="sidebar-menu">
        <div class="sidebar-header">
            <h3>Menu</h3>
            <button onclick="closeSidebar()" class="close-btn">&times;</button>
        </div>
        <div class="sidebar-content">
            
            <div class="sidebar-item sidebar-expandable" onclick="toggleGithubProjects(event)">
                <div class="sidebar-item-header">
                    <span>üîÑ</span> GitHub Projects
                    <span class="expand-icon">‚ñº</span>
                </div>
            </div>
            <div id="githubProjectsList" class="sidebar-submenu" style="display: none;">
                <!-- Popolato dinamicamente -->
            </div>
            
            <div class="sidebar-item sidebar-expandable" onclick="toggleImpostazioni(event)">
                <div class="sidebar-item-header">
                    <span>‚öôÔ∏è</span> Impostazioni
                    <span class="expand-icon">‚ñº</span>
                </div>
            </div>
            <div id="impostazioniMenu" class="sidebar-submenu" style="display: none;">
                <button class="sidebar-action-btn import" onclick="document.getElementById('jsonFileInput').click(); closeSidebar();" title="Importa file JSON di rilievo">
                    <span>üìÅ</span> Importa JSON
                </button>
                <button class="sidebar-action-btn github" onclick="loadProjectsFromGitHub(); closeSidebar();" title="Ricarica progetti da GitHub">
                    <span>üîÑ</span> GitHub
                </button>
                <button class="sidebar-action-btn settings" onclick="showGitHubTokenForm(); closeSidebar();" title="Configura GitHub">
                    <span>‚öôÔ∏è</span> Configura
                </button>
            </div>
            
            <!-- üÜï v8.486: Forza Aggiornamento App -->
            <div class="sidebar-item" onclick="forceUpdateApp()" style="margin-top: 1rem; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 8px;">
                <div class="sidebar-item-header" style="color: white; font-weight: 600;">
                    <span>üîÑ</span> Forza Aggiornamento
                </div>
            </div>
        </div>
    </div>
    
    <!-- Overlay per chiudere sidebar -->
    <div id="sidebarOverlay" class="sidebar-overlay" onclick="closeSidebar()"></div>

    <!-- CONTAINER PRINCIPALE -->
    <div class="container">
        
        <!-- ====================================================================
             BLOCCO 1: GENERALE (ora nascosto di default, accessibile solo da sidebar GitHub)
             ==================================================================== -->
        <div id="blocco-generale" class="blocco">
            <div class="card">
                <div style="margin-bottom: 1.5rem;">
                    <h1 class="card-title" style="margin-bottom: 0.5rem;">üìä Dashboard Generale</h1>
                </div>
                <input type="file" id="jsonFileInput" accept=".json" onchange="handleFileSelect(event)" style="display: none;">

                <!-- STATO DATI -->
                <div id="dataStatus" class="data-status" style="display: none;">
                    <!-- Popolato dinamicamente -->
                </div>
            </div>

            <!-- PLACEHOLDER (nascosto dopo import) -->
            <div id="generalePlaceholder" class="card">
                <div class="placeholder">
                    <div class="placeholder-icon">üìã</div>
                    <div class="placeholder-title">Nessun rilievo caricato</div>
                    <div class="placeholder-text">
                        Carica un file JSON per visualizzare dashboard, KPI e tabella posizioni
                    </div>
                </div>
            </div>

            <!-- CONTENUTO (mostrato dopo import) -->
            <div id="generaleContent" style="display: none;">
                
                <!-- DASHBOARD KPI -->
                <div class="card">
                    <h2 class="card-title">üìä Dashboard KPI</h2>
                    <div id="kpiCards" class="kpi-grid">
                        <!-- Popolato dinamicamente -->
                    </div>
                </div>

                <!-- FILTRI E RICERCA -->
                <div class="card">
                    <h2 class="card-title">üîç Filtra Posizioni</h2>
                    <div class="filters-container">
                        <div class="filter-group">
                            <label>Piano:</label>
                            <select id="filterPiano" onchange="applyFilters()">
                                <option value="">Tutti i piani</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Stanza:</label>
                            <select id="filterStanza" onchange="applyFilters()">
                                <option value="">Tutte le stanze</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Prodotto:</label>
                            <select id="filterProdotto" onchange="applyFilters()">
                                <option value="">Tutti i prodotti</option>
                            </select>
                        </div>
                        <div class="filter-group search-group">
                            <label>Cerca:</label>
                            <input type="text" id="searchInput" placeholder="Cerca per ID, ambiente..." oninput="applyFilters()">
                        </div>
                        <button class="btn btn-secondary" onclick="resetFilters()">üîÑ Reset</button>
                    </div>
                </div>

                <!-- TABELLA POSIZIONI -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h2 class="card-title" style="margin: 0;">üìã Tabella Posizioni</h2>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" onclick="exportToJSON()">üíæ JSON</button>
                            <button class="btn btn-primary" onclick="exportToCSV()">üìä Excel/CSV</button>
                        </div>
                    </div>
                    <div id="tableContainer" class="table-container">
                        <!-- Popolato dinamicamente -->
                    </div>
                </div>

            </div>
        </div>

        <!-- ====================================================================
             BLOCCO 2: UFFICIO (ora default attivo)
             ==================================================================== -->
        <div id="blocco-ufficio" class="blocco active">
            
            <!-- Submenu Blocco Ufficio -->
            <div class="submenu-ufficio">
                <button class="submenu-btn active" onclick="switchVistaUfficio('generale', event)">
                    üìä Vista Generale
                </button>
                <button class="submenu-btn" onclick="switchVistaUfficio('posizioni', event)">
                    üìã Vista Posizioni
                </button>
                <button class="submenu-btn" onclick="switchVistaUfficio('aziende', event)">
                    üè¢ Vista Aziende
                </button>
                <button class="submenu-btn" onclick="switchVistaUfficio('preventivo', event)">
                    üí∞ Preventivo
                </button>
            </div>

            <!-- ============================================================
                 VISTA GENERALE UFFICIO
                 ============================================================ -->
            <div id="vista-generale-ufficio" class="vista-ufficio active">
                
                <!-- Placeholder quando nessun dato caricato -->
                <div id="ufficioPlaceholder">
                    <div class="card">
                        <div class="placeholder">
                            <div class="placeholder-icon">üìä</div>
                            <div class="placeholder-title">Vista Generale Ufficio</div>
                            <div class="placeholder-text">
                                Carica un file JSON dal Blocco Generale per visualizzare<br>
                                le informazioni del progetto, totali commessa e stato avanzamento
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contenuto Vista Generale (nascosto inizialmente) -->
                <div id="ufficioContent" class="content-hidden">
                    
                    <!-- SEZIONE A: Info Cliente -->
                    <div class="card-ufficio">
                        <h2 class="card-ufficio-title">
                            <span class="card-ufficio-icon">üë§</span>
                            Informazioni Cliente e Progetto
                        </h2>
                        <div id="infoCliente" class="info-grid">
                            <!-- Popolato dinamicamente -->
                        </div>
                        <div id="noteProgetto">
                            <!-- Note progetto (se presenti) -->
                        </div>
                    </div>

                    <!-- SEZIONE B2: Configurazione Infissi Globale - RIMOSSA (spostata in Vista Aziende) -->

                    <!-- SEZIONE C: Totali Commessa - Creata dinamicamente v7.21 -->
                    <div id="totaliCommessaContainer"></div>

                    <!-- SEZIONE D: Configurazione Prodotti Globale - v7.997 -->
                    <div id="configGlobaleUfficioContainer" class="card-ufficio" style="display: none;">
                        <h2 class="card-ufficio-title">
                            <span class="card-ufficio-icon">‚öôÔ∏è</span>
                            Configurazione Prodotti Globale
                        </h2>
                        <p style="color: #6b7280; font-size: 0.85rem; margin-bottom: 1rem;">
                            Imposta i valori predefiniti. Simboli: ‚óã PVC base, ‚óè PVC pellicola, ‚óá Alu standard, ‚óÜ Alu legno
                        </p>
                        
                        <!-- Tabs Categorie -->
                        <div class="config-tabs">
                            <button class="config-tab active" onclick="switchConfigTabUfficio('infissi')">ü™ü Infissi</button>
                            <button class="config-tab" onclick="switchConfigTabUfficio('persiane')">üö™ Persiane</button>
                            <button class="config-tab" onclick="switchConfigTabUfficio('tapparelle')">üéöÔ∏è Tapparelle</button>
                            <button class="config-tab" onclick="switchConfigTabUfficio('cassonetti')">üì¶ Cassonetti</button>
                            <button class="config-tab" onclick="switchConfigTabUfficio('zanzariere')">ü¶ü Zanzariere</button>
                        </div>
                        
                        <!-- Pannelli Config -->
                        <div id="configPanelInfissiUfficio" class="config-panel active"></div>
                        <div id="configPanelPersianeUfficio" class="config-panel"></div>
                        <div id="configPanelTapparelleUfficio" class="config-panel"></div>
                        <div id="configPanelCassonettiUfficio" class="config-panel"></div>
                        <div id="configPanelZanzariereUfficio" class="config-panel"></div>
                        
                        <!-- Azioni -->
                        <div class="config-actions">
                            <button class="config-btn config-btn-reset" onclick="resetConfigGlobaleMenuUfficio()">
                                üîÑ Reset
                            </button>
                            <button class="config-btn config-btn-save" onclick="salvaConfigGlobaleMenuUfficio()">
                                üíæ Salva Config
                            </button>
                        </div>
                    </div>

                </div>
            </div>

            <!-- ============================================================
                 VISTA POSIZIONI - Implementata in Chat 100011
                 ============================================================ -->
            <div id="vista-posizioni-ufficio" class="vista-ufficio">
                
                <!-- Placeholder quando nessun dato caricato -->
                <div id="posizioniPlaceholder">
                    <div class="card">
                        <div class="placeholder">
                            <div class="placeholder-icon">üìã</div>
                            <div class="placeholder-title">Vista Posizione per Posizione</div>
                            <div class="placeholder-text">
                                Carica un file JSON dal Blocco Generale per visualizzare<br>
                                il dettaglio completo di ogni posizione rilevata
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contenuto Vista Posizioni (nascosto inizialmente) -->
                <div id="posizioniContent" class="content-hidden">
                    
                    <!-- Header Progetto -->
                    <div id="projectHeaderPosizioni" class="card" style="margin-bottom: 1.5rem;">
                        <div style="padding: 1.5rem;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                                <div>
                                    <h2 id="projectNameDisplay" style="font-size: 1.5rem; color: #1e293b; margin: 0 0 0.5rem 0; font-weight: 700;">
                                        Nome Progetto
                                    </h2>
                                    <div id="projectClientDisplay" style="color: #475569; font-size: 1.1rem; font-weight: 500;">
                                        üë§ Cliente
                                    </div>
                                </div>
                                <div style="text-align: right; color: #6b7280; font-size: 0.9rem;">
                                    <div id="projectDateDisplay" style="margin-bottom: 0.25rem;">
                                        üìÖ Data
                                    </div>
                                    <div id="projectPositionsCountDisplay">
                                        üìç Posizioni
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="positions-layout">
                        
                        <!-- Sidebar Lista Posizioni -->
                        <aside class="positions-sidebar">
                            <div class="positions-sidebar-title">
                                üìã Posizioni
                                <span id="positionsCount" style="font-size: 0.9rem; color: #6b7280; font-weight: 400;"></span>
                            </div>

                            <!-- Lista posizioni -->
                            <div id="positionsList" class="positions-list">
                                <!-- Popolata dinamicamente -->
                            </div>
                        </aside>

                        <!-- Card Dettaglio Posizione -->
                        <div class="position-detail">
                            <!-- ‚ùå v7.997: Config Globale SPOSTATA in Ufficio ‚Üí Vista Generale -->
                            <!-- (Container rimosso - ora in configGlobaleUfficioContainer) -->
                            
                            <!-- üÜï v7.94: Config Globale ora √® DENTRO ogni tab prodotto -->
                            
                            <div id="positionDetailCard" class="position-card">
                                <!-- Popolata dinamicamente -->
                            </div>
                        </div>

                    </div>

                </div>

            </div>

            <!-- ============================================================
                 VISTA AZIENDE (placeholder per prossima chat)
                 ============================================================ -->
            <!-- ============================================================
                 VISTA AZIENDE - Implementata in Chat 10012
                 ============================================================ -->
            <div id="vista-aziende-ufficio" class="vista-ufficio">
                
                <!-- Placeholder quando nessun dato caricato -->
                <div id="aziendePlaceholder">
                    <div class="card">
                        <div class="placeholder">
                            <div class="placeholder-icon">üè¢</div>
                            <div class="placeholder-title">Vista Prodotti per Azienda</div>
                            <div class="placeholder-text">
                                Carica un file JSON dal Blocco Generale per visualizzare<br>
                                il riepilogo prodotti raggruppati per fornitore/azienda
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contenuto vista aziende -->
                <div id="aziendeContent" class="content-hidden">
                    
                    <!-- Header vista -->
                    <div class="card" style="margin-bottom: 1.5rem;">
                        <h2 style="font-size: 1.5rem; font-weight: 700; color: #10b981; margin-bottom: 0.5rem;">
                            üè¢ Vista Prodotti per Azienda
                        </h2>
                        <p style="color: #6b7280; margin: 0;">
                            Riepilogo prodotti raggruppati per fornitore
                        </p>
                    </div>

                    <!-- Contenitore card aziende -->
                    <div id="aziendeCards" class="aziende-container">
                        <!-- Popolato dinamicamente da renderVistaAziende() -->
                    </div>

                </div>
            </div>

            <!-- ============================================================
                 VISTA PREVENTIVO - Foglio Calcolo con Listino Finstral
                 Implementata in Chat v7.22
                 ============================================================ -->
            <div id="vista-preventivo-ufficio" class="vista-ufficio">
                
                <!-- Placeholder quando nessun dato caricato -->
                <div id="preventivoPlaceholder">
                    <div class="card">
                        <div class="placeholder">
                            <div class="placeholder-icon">üí∞</div>
                            <div class="placeholder-title">Vista Preventivo</div>
                            <div class="placeholder-text">
                                Carica un file JSON per calcolare il preventivo con listino Finstral
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contenuto Vista Preventivo (nascosto inizialmente) -->
                <div id="preventivoContent" class="content-hidden">
                    
                    <!-- HEADER PREVENTIVO -->
                    <div class="card">
                        <h2 class="card-title">üí∞ Preventivo - Calcolo Dettagliato</h2>
                        <p class="card-subtitle">
                            Calcolo prezzi con listino Finstral EUR 2025/3 - Sistema supplementi al metro lineare BRM
                        </p>
                    </div>

                    <!-- TOOLBAR AZIONI -->
                    <div class="card" style="padding: 1rem;">
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;">
                            <button class="btn btn-primary" onclick="ricalcolaPreventivo(); ricalcolaTotaliPreventivo();">
                                üîÑ Ricalcola Preventivo
                            </button>
                            <button class="btn btn-success" onclick="exportPreventivoExcel()">
                                üìä Export Excel
                            </button>
                            <button class="btn" onclick="salvaProgettoSuGitHub()" 
                                    style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; font-weight: 600;">
                                üíæ Salva su GitHub
                            </button>
                            
                            <div style="margin-left: auto; display: flex; gap: 0.5rem; align-items: center;">
                                <label style="font-weight: 600;">Ricarico:</label>
                                <input type="number" id="ricaricoPct" value="50" min="0" max="100" step="1" 
                                       onchange="ricalcolaPreventivo(); ricalcolaTotaliPreventivo();" 
                                       style="width: 60px; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; text-align: center; font-weight: 600; background: #fef3c7;">
                                <span style="color: #64748b;">%</span>
                                
                                <div style="width: 1px; height: 24px; background: #d1d5db; margin: 0 0.5rem;"></div>
                                
                                <label style="font-weight: 600;">Tipo Intervento:</label>
                                <select id="tipoInterventoSelect" onchange="ricalcolaTotaliPreventivo()" 
                                        style="padding: 0.5rem; border: 1px solid #6366f1; border-radius: 0.375rem; font-size: 0.8rem; background: #eef2ff;">
                                    <option value="nessuna">Senza IVA</option>
                                    <option value="manutenzione" selected>Manutenzione ord/straord (IVA mista)</option>
                                    <option value="ristrutturazione">Ristrutturazione (tutto 10%)</option>
                                    <option value="nuova_costruzione_prima">Nuova costr. 1¬™ casa (4%)</option>
                                    <option value="nuova_costruzione_altra">Nuova costr. altra (10%)</option>
                                    <option value="sola_fornitura">Sola fornitura (22%)</option>
                                </select>
                                
                                <span id="labelTipoIVA" style="font-size: 0.7rem; color: #6366f1; margin-left: 0.25rem;">
                                    üìä Beni signif.
                                </span>
                            </div>
                        </div>
                        
                        <!-- üÜï v8.40: PULSANTE UNICO GENERA DOCUMENTO -->
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e5e7eb;">
                            <span style="font-weight: 700; color: #374151;">üìÑ Documenti Cliente:</span>
                            
                            <button type="button" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; font-weight: 600; padding: 0.75rem 1.5rem; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem;"
                                    onclick="window.apriSceltaDocumento()">
                                üìÑ Genera Documento
                            </button>
                        </div>
                    </div>

                    <!-- TABELLA FOGLIO CALCOLO STILE EXCEL -->
                    <div class="card" style="padding: 0; overflow: auto;">
                        <div class="excel-container">
                            <table class="excel-table" id="preventivoTable">
                                <thead>
                                    <tr>
                                        <th class="excel-col-narrow">Pos</th>
                                        <th class="excel-col-medium">Ambiente</th>
                                        <th class="excel-col-narrow">Tipo</th>
                                        <th class="excel-col-medium">Azienda</th>
                                        <th class="excel-col-narrow">Telaio</th>
                                        <th class="excel-col-narrow">L</th>
                                        <th class="excel-col-narrow">H</th>
                                        <th class="excel-col-narrow">m¬≤</th>
                                        <th class="excel-col-narrow">ml</th>
                                        <th class="excel-col-narrow">Base</th>
                                        <th class="excel-col-narrow">Tel.</th>
                                        <th class="excel-col-narrow">Anta</th>
                                        <th class="excel-col-narrow">Vetro</th>
                                        <th class="excel-col-narrow">Col.</th>
                                        <th class="excel-col-narrow">Man.</th>
                                        <th class="excel-col-narrow">Mont.</th>
                                        <th class="excel-col-narrow">Qt</th>
                                        <th class="excel-col-narrow" style="background: #fef3c7;">LIST.</th>
                                        <th class="excel-col-narrow" style="background: #d1fae5;">Sc%</th>
                                        <th class="excel-col-narrow" style="background: #d1fae5;">NETTO</th>
                                        <th class="excel-col-wide" style="background: #dbeafe;">CLIENTE</th>
                                    </tr>
                                </thead>
                                <tbody id="preventivoTableBody">
                                    <!-- Popolato dinamicamente -->
                                </tbody>
                                <tfoot>
                                    <!-- SUBTOTALE MATERIALI -->
                                    <tr class="excel-subtotal-row" style="background: #f0f9ff;">
                                        <td colspan="17" style="text-align: right; font-weight: 700;">SUBTOTALE MATERIALI:</td>
                                        <td class="excel-subtotal-value" id="totaleListino" style="background: #fef3c7;">‚Ç¨ 0.00</td>
                                        <td style="background: #d1fae5;"></td>
                                        <td class="excel-subtotal-value" id="totaleNetto" style="background: #d1fae5; color: #059669;">‚Ç¨ 0.00</td>
                                        <td class="excel-subtotal-value" id="totaleCliente" style="background: #dbeafe; color: #1d4ed8;">‚Ç¨ 0.00</td>
                                    </tr>
                                    <!-- SEPARATORE LAVORI -->
                                    <tr style="height: 8px; background: #fbbf24;">
                                        <td colspan="21" style="text-align: center; font-size: 0.7rem; color: #78350f; font-weight: 600;">üîß COSTI LAVORO (senza ricarico)</td>
                                    </tr>
                                    <!-- POSA IN OPERA -->
                                    <tr class="excel-row" style="background: #fffbeb;">
                                        <td colspan="14" style="text-align: right; font-weight: 600;">üîß Posa in opera:</td>
                                        <td style="text-align: right; font-size: 0.75rem; color: #6b7280;" id="posaSuggerito">sugg. ‚Ç¨0</td>
                                        <td colspan="2" style="text-align: right;">
                                            <input type="number" id="inputPosa" value="0" min="0" step="50" 
                                                   onchange="ricalcolaTotaliPreventivo()" 
                                                   style="width: 80px; padding: 4px; border: 1px solid #f59e0b; border-radius: 4px; text-align: right; background: #fffbeb;">
                                            <span style="color: #92400e; font-size: 0.8rem;"> ‚Ç¨</span>
                                        </td>
                                        <td class="excel-value" id="totalePosaListino" style="background: #fffbeb;">‚Ç¨ 0.00</td>
                                        <td style="background: #fffbeb;"></td>
                                        <td class="excel-value" id="totalePosaNetto" style="color: #059669; background: #fffbeb;">‚Ç¨ 0.00</td>
                                        <td class="excel-value" id="totalePosaCliente" style="color: #1d4ed8; background: #fffbeb;">‚Ç¨ 0.00</td>
                                    </tr>
                                    <!-- SMONTAGGIO -->
                                    <tr class="excel-row" style="background: #fffbeb;">
                                        <td colspan="14" style="text-align: right; font-weight: 600;">üî® Smontaggio:</td>
                                        <td style="text-align: right; font-size: 0.75rem; color: #6b7280;" id="smontaggioSuggerito">sugg. ‚Ç¨0</td>
                                        <td colspan="2" style="text-align: right;">
                                            <input type="number" id="inputSmontaggio" value="0" min="0" step="10" 
                                                   onchange="ricalcolaTotaliPreventivo()" 
                                                   style="width: 80px; padding: 4px; border: 1px solid #f59e0b; border-radius: 4px; text-align: right; background: #fffbeb;">
                                            <span style="color: #92400e; font-size: 0.8rem;"> ‚Ç¨</span>
                                        </td>
                                        <td class="excel-value" id="totaleSmontaggioListino" style="background: #fffbeb;">‚Ç¨ 0.00</td>
                                        <td style="background: #fffbeb;"></td>
                                        <td class="excel-value" id="totaleSmontaggioNetto" style="color: #059669; background: #fffbeb;">‚Ç¨ 0.00</td>
                                        <td class="excel-value" id="totaleSmontaggioCliente" style="color: #1d4ed8; background: #fffbeb;">‚Ç¨ 0.00</td>
                                    </tr>
                                    <!-- SMALTIMENTO -->
                                    <tr class="excel-row" style="background: #fffbeb;">
                                        <td colspan="14" style="text-align: right; font-weight: 600;">üóëÔ∏è Smaltimento:</td>
                                        <td style="text-align: right; font-size: 0.75rem; color: #6b7280;" id="smaltimentoSuggerito">sugg. ‚Ç¨0</td>
                                        <td colspan="2" style="text-align: right;">
                                            <input type="number" id="inputSmaltimento" value="0" min="0" step="10" 
                                                   onchange="ricalcolaTotaliPreventivo()" 
                                                   style="width: 80px; padding: 4px; border: 1px solid #f59e0b; border-radius: 4px; text-align: right; background: #fffbeb;">
                                            <span style="color: #92400e; font-size: 0.8rem;"> ‚Ç¨</span>
                                        </td>
                                        <td class="excel-value" id="totaleSmaltimentoListino" style="background: #fffbeb;">‚Ç¨ 0.00</td>
                                        <td style="background: #fffbeb;"></td>
                                        <td class="excel-value" id="totaleSmaltimentoNetto" style="color: #059669; background: #fffbeb;">‚Ç¨ 0.00</td>
                                        <td class="excel-value" id="totaleSmaltimentoCliente" style="color: #1d4ed8; background: #fffbeb;">‚Ç¨ 0.00</td>
                                    </tr>
                                    <!-- COMPONENTI POSA -->
                                    <tr class="excel-row" style="background: #fffbeb;">
                                        <td colspan="14" style="text-align: right; font-weight: 600;">üî© Componenti posa:</td>
                                        <td style="text-align: right; font-size: 0.75rem; color: #6b7280;" id="componentiSuggerito">sugg. ‚Ç¨0</td>
                                        <td colspan="2" style="text-align: right;">
                                            <input type="number" id="inputComponenti" value="0" min="0" step="5" 
                                                   onchange="ricalcolaTotaliPreventivo()" 
                                                   style="width: 80px; padding: 4px; border: 1px solid #f59e0b; border-radius: 4px; text-align: right; background: #fffbeb;">
                                            <span style="color: #92400e; font-size: 0.8rem;"> ‚Ç¨</span>
                                        </td>
                                        <td class="excel-value" id="totaleComponentiListino" style="background: #fffbeb;">‚Ç¨ 0.00</td>
                                        <td style="background: #fffbeb;"></td>
                                        <td class="excel-value" id="totaleComponentiNetto" style="color: #059669; background: #fffbeb;">‚Ç¨ 0.00</td>
                                        <td class="excel-value" id="totaleComponentiCliente" style="color: #1d4ed8; background: #fffbeb;">‚Ç¨ 0.00</td>
                                    </tr>
                                    <!-- ENEA ECOBONUS v8.40 -->
                                    <tr class="excel-row" id="rowENEA" style="background: #f0fdf4;">
                                        <td colspan="13" style="text-align: right; font-weight: 600;">üìÑ Elaborazione ENEA:</td>
                                        <td style="text-align: center;">
                                            <input type="checkbox" id="checkENEA" checked onchange="ricalcolaTotaliPreventivo()" style="width: 18px; height: 18px; cursor: pointer;">
                                        </td>
                                        <td style="text-align: right; font-size: 0.75rem; color: #6b7280;">(IVA 22%)</td>
                                        <td colspan="2" style="text-align: right;">
                                            <input type="number" id="inputENEA" value="250" min="0" step="10" onchange="ricalcolaTotaliPreventivo()" style="width: 80px; padding: 4px; border: 1px solid #10b981; border-radius: 4px; text-align: right; background: #f0fdf4;">
                                            <span style="color: #065f46; font-size: 0.8rem;"> ‚Ç¨</span>
                                        </td>
                                        <td class="excel-value" id="totaleENEAListino" style="background: #f0fdf4;">‚Ç¨ 0.00</td>
                                        <td style="background: #f0fdf4;"></td>
                                        <td class="excel-value" id="totaleENEANetto" style="color: #059669; background: #f0fdf4;">‚Ç¨ 0.00</td>
                                        <td class="excel-value" id="totaleENEACliente" style="color: #1d4ed8; background: #f0fdf4;">‚Ç¨ 0.00</td>
                                    </tr>
                                    <!-- SERVIZI/ONERI AGGIUNTIVI v8.485 - Sempre IVA 22% -->
                                    <tr class="excel-row" id="rowServizi" style="background: #fef3c7;">
                                        <td colspan="13" style="text-align: right; font-weight: 600;">üîß Servizi/Oneri aggiuntivi:</td>
                                        <td style="text-align: center;">
                                            <input type="checkbox" id="checkServizi" onchange="ricalcolaTotaliPreventivo()" style="width: 18px; height: 18px; cursor: pointer;">
                                        </td>
                                        <td style="text-align: right; font-size: 0.75rem; color: #6b7280;">(IVA 22%)</td>
                                        <td colspan="2" style="text-align: right;">
                                            <input type="number" id="inputServizi" value="0" min="0" step="10" onchange="ricalcolaTotaliPreventivo()" style="width: 80px; padding: 4px; border: 1px solid #f59e0b; border-radius: 4px; text-align: right; background: #fffbeb;" disabled>
                                            <span style="color: #92400e; font-size: 0.8rem;"> ‚Ç¨</span>
                                        </td>
                                        <td class="excel-value" id="totaleServiziListino" style="background: #fef3c7;">‚Ç¨ 0.00</td>
                                        <td style="background: #fef3c7;"></td>
                                        <td class="excel-value" id="totaleServiziNetto" style="color: #059669; background: #fef3c7;">‚Ç¨ 0.00</td>
                                        <td class="excel-value" id="totaleServiziCliente" style="color: #1d4ed8; background: #fef3c7;">‚Ç¨ 0.00</td>
                                    </tr>
                                    <!-- VOCE EXTRA 1 v8.491 -->
                                    <tr class="excel-row" id="rowVoceExtra1" style="background: #f5f3ff;">
                                        <td colspan="9" style="text-align: right; font-weight: 600;">üìù Voce extra:</td>
                                        <td colspan="4" style="text-align: right;">
                                            <input type="text" id="inputNomeVoceExtra1" placeholder="Descrizione..." onchange="ricalcolaTotaliPreventivo()" style="width: 140px; padding: 4px; border: 1px solid #8b5cf6; border-radius: 4px; background: #f5f3ff; font-size: 0.8rem;">
                                        </td>
                                        <td style="text-align: center;">
                                            <input type="checkbox" id="checkVoceExtra1" onchange="ricalcolaTotaliPreventivo()" style="width: 18px; height: 18px; cursor: pointer;">
                                        </td>
                                        <td style="text-align: right;">
                                            <select id="selectIVAVoceExtra1" onchange="ricalcolaTotaliPreventivo()" style="padding: 3px; border: 1px solid #8b5cf6; border-radius: 4px; font-size: 0.75rem; background: #f5f3ff;">
                                                <option value="10">IVA 10%</option>
                                                <option value="22" selected>IVA 22%</option>
                                            </select>
                                        </td>
                                        <td colspan="2" style="text-align: right;">
                                            <input type="number" id="inputVoceExtra1" value="0" min="-10000" step="10" onchange="ricalcolaTotaliPreventivo()" style="width: 80px; padding: 4px; border: 1px solid #8b5cf6; border-radius: 4px; text-align: right; background: #f5f3ff;">
                                            <span style="color: #6d28d9; font-size: 0.8rem;"> ‚Ç¨</span>
                                        </td>
                                        <td class="excel-value" id="totaleVoceExtra1Listino" style="background: #f5f3ff;">‚Ç¨ 0.00</td>
                                        <td style="background: #f5f3ff;"></td>
                                        <td class="excel-value" id="totaleVoceExtra1Netto" style="color: #059669; background: #f5f3ff;">‚Ç¨ 0.00</td>
                                        <td class="excel-value" id="totaleVoceExtra1Cliente" style="color: #1d4ed8; background: #f5f3ff;">‚Ç¨ 0.00</td>
                                    </tr>
                                    <!-- VOCE EXTRA 2 v8.491 -->
                                    <tr class="excel-row" id="rowVoceExtra2" style="background: #fdf4ff;">
                                        <td colspan="9" style="text-align: right; font-weight: 600;">üìù Voce extra:</td>
                                        <td colspan="4" style="text-align: right;">
                                            <input type="text" id="inputNomeVoceExtra2" placeholder="Descrizione..." onchange="ricalcolaTotaliPreventivo()" style="width: 140px; padding: 4px; border: 1px solid #d946ef; border-radius: 4px; background: #fdf4ff; font-size: 0.8rem;">
                                        </td>
                                        <td style="text-align: center;">
                                            <input type="checkbox" id="checkVoceExtra2" onchange="ricalcolaTotaliPreventivo()" style="width: 18px; height: 18px; cursor: pointer;">
                                        </td>
                                        <td style="text-align: right;">
                                            <select id="selectIVAVoceExtra2" onchange="ricalcolaTotaliPreventivo()" style="padding: 3px; border: 1px solid #d946ef; border-radius: 4px; font-size: 0.75rem; background: #fdf4ff;">
                                                <option value="10">IVA 10%</option>
                                                <option value="22" selected>IVA 22%</option>
                                            </select>
                                        </td>
                                        <td colspan="2" style="text-align: right;">
                                            <input type="number" id="inputVoceExtra2" value="0" min="-10000" step="10" onchange="ricalcolaTotaliPreventivo()" style="width: 80px; padding: 4px; border: 1px solid #d946ef; border-radius: 4px; text-align: right; background: #fdf4ff;">
                                            <span style="color: #a21caf; font-size: 0.8rem;"> ‚Ç¨</span>
                                        </td>
                                        <td class="excel-value" id="totaleVoceExtra2Listino" style="background: #fdf4ff;">‚Ç¨ 0.00</td>
                                        <td style="background: #fdf4ff;"></td>
                                        <td class="excel-value" id="totaleVoceExtra2Netto" style="color: #059669; background: #fdf4ff;">‚Ç¨ 0.00</td>
                                        <td class="excel-value" id="totaleVoceExtra2Cliente" style="color: #1d4ed8; background: #fdf4ff;">‚Ç¨ 0.00</td>
                                    </tr>
                                    <!-- TOTALE LAVORI -->
                                    <tr class="excel-row" style="background: #fef3c7;">
                                        <td colspan="17" style="text-align: right; font-weight: 700; color: #92400e;">TOTALE LAVORI:</td>
                                        <td class="excel-value" id="totaleLavoriListino" style="font-weight: 700; background: #fef3c7;">‚Ç¨ 0.00</td>
                                        <td style="background: #fef3c7;"></td>
                                        <td class="excel-value" id="totaleLavoriNetto" style="color: #059669; font-weight: 700; background: #fef3c7;">‚Ç¨ 0.00</td>
                                        <td class="excel-value" id="totaleLavoriCliente" style="color: #1d4ed8; font-weight: 700; background: #fef3c7;">‚Ç¨ 0.00</td>
                                    </tr>
                                    <!-- SEPARATORE -->
                                    <tr style="height: 4px; background: #1e40af;">
                                        <td colspan="21"></td>
                                    </tr>
                                    <!-- SUBTOTALE GENERALE -->
                                    <tr class="excel-subtotal-row">
                                        <td colspan="17" style="text-align: right; font-weight: 700;">SUBTOTALE:</td>
                                        <td class="excel-subtotal-value" id="subtotaleListino">‚Ç¨ 0.00</td>
                                        <td></td>
                                        <td class="excel-subtotal-value" id="subtotaleNetto" style="color: #059669;">‚Ç¨ 0.00</td>
                                        <td class="excel-subtotal-value" id="subtotaleCliente" style="color: #1d4ed8;">‚Ç¨ 0.00</td>
                                    </tr>
                                    <!-- MARGINE -->
                                    <tr class="excel-row" style="background: #ecfdf5;">
                                        <td colspan="17" style="text-align: right; font-weight: 700; color: #059669;">üí∞ TUO MARGINE:</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td class="excel-value" id="totaleMargineLordo" style="font-weight: 700; color: #059669;">‚Ç¨ 0.00</td>
                                    </tr>
                                    <!-- SEPARATORE RIEPILOGO FISCALE -->
                                    <tr id="rowSeparatoreFiscale" style="height: 8px; background: #6366f1; display: none;">
                                        <td colspan="21" style="text-align: center; font-size: 0.65rem; color: white; font-weight: 600;">
                                            üìä RIEPILOGO FISCALE (Art. 7 L. 488/99 - Beni Significativi)
                                        </td>
                                    </tr>
                                    
                                    <!-- BENI SIGNIFICATIVI QUOTA 10% -->
                                    <tr class="excel-row" id="rowBeniSignif10" style="display: none; background: #f0fdf4;">
                                        <td colspan="17" style="text-align: right; font-size: 0.8rem;">
                                            Serramenti (bene significativo - quota 10%):
                                        </td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td class="excel-value" id="valBeniSignif10" style="color: #059669;">‚Ç¨ 0.00</td>
                                    </tr>
                                    
                                    <!-- BENI SIGNIFICATIVI QUOTA 22% -->
                                    <tr class="excel-row" id="rowBeniSignif22" style="display: none; background: #fef2f2;">
                                        <td colspan="17" style="text-align: right; font-size: 0.8rem;">
                                            Serramenti (bene significativo - quota 22%):
                                        </td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td class="excel-value" id="valBeniSignif22" style="color: #dc2626;">‚Ç¨ 0.00</td>
                                    </tr>
                                    
                                    <!-- PARTI AUTONOME -->
                                    <tr class="excel-row" id="rowPartiAutonome" style="display: none; background: #f0fdf4;">
                                        <td colspan="17" style="text-align: right; font-size: 0.8rem;">
                                            Cassonetti/Oscuranti (non integrati - 10%):
                                        </td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td class="excel-value" id="valPartiAutonome" style="color: #059669;">‚Ç¨ 0.00</td>
                                    </tr>
                                    
                                    <!-- MANODOPERA -->
                                    <tr class="excel-row" id="rowManodoperaFiscale" style="display: none; background: #f0fdf4;">
                                        <td colspan="17" style="text-align: right; font-size: 0.8rem;">
                                            Manodopera (sempre 10%):
                                        </td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td class="excel-value" id="valManodoperaFiscale" style="color: #059669;">‚Ç¨ 0.00</td>
                                    </tr>
                                    
                                    <!-- ENEA FISCALE (sempre 22%) -->
                                    <tr class="excel-row" id="rowENEAFiscale" style="display: none; background: #fef2f2;">
                                        <td colspan="17" style="text-align: right; font-size: 0.8rem;">
                                            Pratiche ENEA (sempre 22%):
                                        </td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td class="excel-value" id="valENEAFiscale" style="color: #dc2626;">‚Ç¨ 0.00</td>
                                    </tr>
                                    
                                    <!-- SERVIZI PROFESSIONALI FISCALE (sempre 22%) -->
                                    <tr class="excel-row" id="rowServiziProfFiscale" style="display: none; background: #fef2f2;">
                                        <td colspan="17" style="text-align: right; font-size: 0.8rem;">
                                            Servizi professionali (sempre 22%):
                                        </td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td class="excel-value" id="valServiziProfFiscale" style="color: #dc2626;">‚Ç¨ 0.00</td>
                                    </tr>
                                    
                                    <!-- SEPARATORE IMPONIBILI -->
                                    <tr id="rowSepImponibili" style="height: 2px; background: #d1d5db; display: none;">
                                        <td colspan="21"></td>
                                    </tr>
                                    
                                    <!-- IMPONIBILE 10% -->
                                    <tr class="excel-row" id="rowImponibile10" style="display: none; background: #ecfdf5;">
                                        <td colspan="17" style="text-align: right; font-weight: 600; color: #059669;">
                                            IMPONIBILE IVA 10%:
                                        </td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td class="excel-value" id="valImponibile10" style="font-weight: 600; color: #059669;">‚Ç¨ 0.00</td>
                                    </tr>
                                    
                                    <!-- IMPONIBILE 22% -->
                                    <tr class="excel-row" id="rowImponibile22" style="display: none; background: #fef2f2;">
                                        <td colspan="17" style="text-align: right; font-weight: 600; color: #dc2626;">
                                            IMPONIBILE IVA 22%:
                                        </td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td class="excel-value" id="valImponibile22" style="font-weight: 600; color: #dc2626;">‚Ç¨ 0.00</td>
                                    </tr>
                                    
                                    <!-- IVA 10% -->
                                    <tr class="excel-row" id="rowIVA10" style="display: none;">
                                        <td colspan="17" style="text-align: right; font-weight: 600;">
                                            IVA 10%:
                                        </td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td class="excel-value" id="valIVA10">‚Ç¨ 0.00</td>
                                    </tr>
                                    
                                    <!-- IVA 22% -->
                                    <tr class="excel-row" id="rowIVA22" style="display: none;">
                                        <td colspan="17" style="text-align: right; font-weight: 600;">
                                            IVA 22%:
                                        </td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td class="excel-value" id="valIVA22">‚Ç¨ 0.00</td>
                                    </tr>
                                    
                                    <!-- IVA SINGOLA (per altri tipi intervento) -->
                                    <tr class="excel-row" id="rowIVA" style="display: none;">
                                        <td colspan="17" style="text-align: right; font-weight: 600;">IVA (<span id="ivaPercent">22</span>%):</td>
                                        <td class="excel-value" id="totaleIVAListino">‚Ç¨ 0.00</td>
                                        <td></td>
                                        <td class="excel-value" id="totaleIVANetto">‚Ç¨ 0.00</td>
                                        <td class="excel-value" id="totaleIVACliente">‚Ç¨ 0.00</td>
                                    </tr>
                                    <!-- TOTALE FINALE -->
                                    <tr class="excel-grand-total-row">
                                        <td colspan="17" style="text-align: right; font-weight: 700; font-size: 1.1rem;">TOTALE PREVENTIVO:</td>
                                        <td class="excel-grand-total-value" id="grandTotalListino">‚Ç¨ 0.00</td>
                                        <td></td>
                                        <td class="excel-grand-total-value" id="grandTotalNetto" style="color: #059669;">‚Ç¨ 0.00</td>
                                        <td class="excel-grand-total-value" id="grandTotalCliente" style="color: #1d4ed8; font-size: 1.1rem;">‚Ç¨ 0.00</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>

                    <!-- LEGENDA CALCOLO -->
                    <div class="card">
                        <h3 style="font-size: 1rem; font-weight: 600; color: #1f2937; margin-bottom: 1rem;">
                            üìã Legenda Calcolo Finstral
                        </h3>
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 0.5rem; font-size: 0.875rem; line-height: 1.6;">
                            <p><strong>Sistema Finstral EUR 2025/3:</strong></p>
                            <ul style="margin: 0.5rem 0 0 1.5rem;">
                                <li><strong>Perimetro BRM (ml):</strong> 2 √ó (Larghezza + Altezza) / 1000</li>
                                <li><strong>Base ‚Ç¨:</strong> Prezzo base per tipologia infisso (MOCK: ‚Ç¨ 350-600)</li>
                                <li><strong>Suppl. ‚Ç¨:</strong> Supplemento telaio al metro lineare √ó Perimetro BRM</li>
                                <li><strong>Unit. ‚Ç¨:</strong> Base + Supplementi</li>
                                <li><strong>Totale ‚Ç¨:</strong> Prezzo Unitario √ó Quantit√†</li>
                            </ul>
                            <p style="margin-top: 0.5rem;"><em>Note: Prezzi base MOCK per testing. Integrare listino completo Finstral.</em></p>
                        </div>
                    </div>

                </div>
            </div>

        </div>
    <div id="brm-modal-overlay" class="brm-modal-overlay">
<div class="brm-modal">
    <div class="brm-modal-header">
        <h2 class="brm-modal-title">‚ö†Ô∏è Selezione Misure BRM</h2>
        <p class="brm-modal-subtitle" id="brm-posizione-nome"></p>
    </div>
    
    <div class="brm-modal-body">
        <div class="brm-alert">
            <p class="brm-alert-text">
                Le misure BRM non sono state definite nel rilievo. 
                Seleziona quali misure usare come riferimento per il listino Finstral.
            </p>
        </div>
        
        <div class="brm-section" id="brm-section-larghezza" style="display: none;">
            <div class="brm-section-title">
                <span class="brm-section-icon">‚ÜîÔ∏è</span>
                LARGHEZZA
            </div>
            <div class="brm-options" id="brm-options-larghezza"></div>
        </div>
        
        <div class="brm-section" id="brm-section-altezza" style="display: none;">
            <div class="brm-section-title">
                <span class="brm-section-icon">‚ÜïÔ∏è</span>
                ALTEZZA
            </div>
            <div class="brm-options" id="brm-options-altezza"></div>
        </div>
    </div>
    
    <div class="brm-modal-actions">
        <button class="brm-btn brm-btn-secondary" onclick="chiudiModalBRM()">Annulla</button>
        <button class="brm-btn brm-btn-primary" id="brm-btn-conferma" onclick="confermaBRM()" disabled>
            Conferma e Calcola ‚úì
        </button>
    </div>
</div>
    </div>

    <div id="listini-modal" class="preventivo-modal-overlay" style="display: none;" onclick="if(event.target===this) chiudiGestioneListini()">
<div class="preventivo-modal" style="max-width: 1200px; max-height: 90vh; overflow-y: auto;">
    <div class="preventivo-modal-header">
        <h2 class="preventivo-modal-title">üìö Gestione Listini Prezzi</h2>
        <button class="preventivo-modal-close" onclick="chiudiGestioneListini()">‚úï</button>
    </div>
    
    <div style="display: flex; gap: 1rem; padding: 1rem; border-bottom: 2px solid #e5e7eb; background: #f9fafb;">
        <button class="tab-listini active" onclick="switchTabListini('persiane')">
            üö™ Persiane
        </button>
        <button class="tab-listini" onclick="switchTabListini('tapparelle')">
            üéöÔ∏è Tapparelle
        </button>
        <button class="tab-listini" onclick="switchTabListini('zanzariere')">
            ü¶ü Zanzariere
        </button>
        <button class="tab-listini" onclick="switchTabListini('test')">
            üß™ Test Calcolo
        </button>
    </div>
    
    <div id="tab-content-persiane" class="tab-content-listini" style="padding: 1.5rem;">
        <h3 style="margin-bottom: 1rem; color: #1f2937;">üìä Listino Persiane - STEP 1</h3>
        
        <div style="background: #f0fdf4; border-left: 4px solid #10b981; padding: 1rem; margin-bottom: 1.5rem; border-radius: 0.5rem;">
            <p style="margin: 0; font-weight: 600; color: #065f46;">
                ‚ÑπÔ∏è Versione: <span id="listino-persiane-versione"></span> | 
                Aggiornamento: <span id="listino-persiane-data"></span>
            </p>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem; color: #047857;">
                üìÑ Fonte: <span id="listino-persiane-fonte"></span>
            </p>
        </div>
        
        <div style="margin-bottom: 1.5rem;">
            <h4 style="margin-bottom: 0.75rem; color: #374151;">üèóÔ∏è Modelli Disponibili</h4>
            <div id="listino-persiane-modelli"></div>
        </div>
        
        <div style="margin-bottom: 1.5rem;">
            <h4 style="margin-bottom: 0.75rem; color: #374151;">üõ†Ô∏è Telai</h4>
            <div id="listino-persiane-telai"></div>
        </div>
        
        <div style="margin-bottom: 1.5rem;">
            <h4 style="margin-bottom: 0.75rem; color: #374151;">üé® Colori</h4>
            <div id="listino-persiane-colori"></div>
        </div>
        
        <div>
            <h4 style="margin-bottom: 0.75rem; color: #374151;">üí∞ Supplementi</h4>
            <div id="listino-persiane-supplementi"></div>
        </div>
    </div>
    
    <div id="tab-content-tapparelle" class="tab-content-listini" style="display: none; padding: 1.5rem;">
        <h3 style="margin-bottom: 1rem; color: #1f2937;">üìä Listino Tapparelle - PLASTICINO</h3>
        
        <div style="background: #eff6ff; border-left: 4px solid #3b82f6; padding: 1rem; margin-bottom: 1.5rem; border-radius: 0.5rem;">
            <p style="margin: 0; font-weight: 600; color: #1e40af;">
                ‚ÑπÔ∏è Aziende: Plasticino | New Solar | Estella
            </p>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem; color: #1e3a8a;">
                üìÑ Formula: <strong>TOTALE = (L √ó ‚Ç¨13.20/m) + ‚Ç¨66.40 + Supplemento H</strong>
            </p>
        </div>
        
        <div style="margin-bottom: 1.5rem; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1rem;">
            <h4 style="margin: 0 0 1rem 0; color: #374151;">üßÆ Formula di Calcolo</h4>
            <div style="font-family: monospace; background: white; padding: 1rem; border-radius: 0.375rem; border: 1px solid #d1d5db;">
                <div style="margin-bottom: 0.5rem;"><strong>TOTALE</strong> = <span style="color: #2563eb;">(L_metri √ó 13.20)</span> + <span style="color: #059669;">66.40</span> + <span style="color: #dc2626;">Supplemento_H</span></div>
                <div style="font-size: 0.875rem; color: #6b7280; margin-top: 0.5rem;">
                    ‚Ä¢ L_metri = Larghezza in metri (L_cm √∑ 100)<br>
                    ‚Ä¢ 13.20 = Costo rullo ‚Ç¨/metro lineare<br>
                    ‚Ä¢ 66.40 = Totale componenti fissi<br>
                    ‚Ä¢ Supplemento_H = ‚Ç¨0.50/metro se H > 300cm
                </div>
            </div>
        </div>
        
        <div style="margin-bottom: 1.5rem;">
            <h4 style="margin-bottom: 0.75rem; color: #374151;">üîß Componenti Fissi (‚Ç¨66.40)</h4>
            <table style="width: 100%; border-collapse: collapse; font-size: 0.875rem;">
                <thead>
                    <tr style="background: #f3f4f6;">
                        <th style="padding: 0.5rem; text-align: left; border: 1px solid #e5e7eb;">Codice</th>
                        <th style="padding: 0.5rem; text-align: left; border: 1px solid #e5e7eb;">Descrizione</th>
                        <th style="padding: 0.5rem; text-align: right; border: 1px solid #e5e7eb;">Prezzo</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="padding: 0.5rem; border: 1px solid #e5e7eb;">COMP-01</td>
                        <td style="padding: 0.5rem; border: 1px solid #e5e7eb;">Rullo Ottagonale 60mm</td>
                        <td style="padding: 0.5rem; text-align: right; border: 1px solid #e5e7eb; color: #2563eb; font-weight: 600;">‚Ç¨13.20/m</td>
                    </tr>
                    <tr style="background: #f9fafb;">
                        <td style="padding: 0.5rem; border: 1px solid #e5e7eb;">COMP-02</td>
                        <td style="padding: 0.5rem; border: 1px solid #e5e7eb;">Calotta</td>
                        <td style="padding: 0.5rem; text-align: right; border: 1px solid #e5e7eb;">‚Ç¨15.00</td>
                    </tr>
                    <tr>
                        <td style="padding: 0.5rem; border: 1px solid #e5e7eb;">COMP-03</td>
                        <td style="padding: 0.5rem; border: 1px solid #e5e7eb;">Avvolgitore</td>
                        <td style="padding: 0.5rem; text-align: right; border: 1px solid #e5e7eb;">‚Ç¨10.00</td>
                    </tr>
                    <tr style="background: #f9fafb;">
                        <td style="padding: 0.5rem; border: 1px solid #e5e7eb;">COMP-04</td>
                        <td style="padding: 0.5rem; border: 1px solid #e5e7eb;">Cuscinetto</td>
                        <td style="padding: 0.5rem; text-align: right; border: 1px solid #e5e7eb;">‚Ç¨3.50</td>
                    </tr>
                    <tr>
                        <td style="padding: 0.5rem; border: 1px solid #e5e7eb;">COMP-05</td>
                        <td style="padding: 0.5rem; border: 1px solid #e5e7eb;">Supporti x2</td>
                        <td style="padding: 0.5rem; text-align: right; border: 1px solid #e5e7eb;">‚Ç¨6.00</td>
                    </tr>
                    <tr style="background: #f9fafb;">
                        <td style="padding: 0.5rem; border: 1px solid #e5e7eb;">COMP-06</td>
                        <td style="padding: 0.5rem; border: 1px solid #e5e7eb;">Ganci x2</td>
                        <td style="padding: 0.5rem; text-align: right; border: 1px solid #e5e7eb;">‚Ç¨7.20</td>
                    </tr>
                    <tr>
                        <td style="padding: 0.5rem; border: 1px solid #e5e7eb;">COMP-08</td>
                        <td style="padding: 0.5rem; border: 1px solid #e5e7eb;">Placca</td>
                        <td style="padding: 0.5rem; text-align: right; border: 1px solid #e5e7eb;">‚Ç¨5.00</td>
                    </tr>
                    <tr style="background: #f9fafb;">
                        <td style="padding: 0.5rem; border: 1px solid #e5e7eb;">COMP-09</td>
                        <td style="padding: 0.5rem; border: 1px solid #e5e7eb;">Passacinghia</td>
                        <td style="padding: 0.5rem; text-align: right; border: 1px solid #e5e7eb;">‚Ç¨1.70</td>
                    </tr>
                    <tr>
                        <td style="padding: 0.5rem; border: 1px solid #e5e7eb;">COMP-10</td>
                        <td style="padding: 0.5rem; border: 1px solid #e5e7eb;">Macchinetta</td>
                        <td style="padding: 0.5rem; text-align: right; border: 1px solid #e5e7eb;">‚Ç¨18.00</td>
                    </tr>
                    <tr style="background: #dcfce7; font-weight: 600;">
                        <td colspan="2" style="padding: 0.5rem; border: 1px solid #e5e7eb; text-align: right;">TOTALE COMPONENTI FISSI:</td>
                        <td style="padding: 0.5rem; text-align: right; border: 1px solid #e5e7eb; color: #059669;">‚Ç¨66.40</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div style="margin-bottom: 1.5rem;">
            <h4 style="margin-bottom: 0.75rem; color: #374151;">üí∞ Supplementi</h4>
            <table style="width: 100%; border-collapse: collapse; font-size: 0.875rem;">
                <thead>
                    <tr style="background: #f3f4f6;">
                        <th style="padding: 0.5rem; text-align: left; border: 1px solid #e5e7eb;">Codice</th>
                        <th style="padding: 0.5rem; text-align: left; border: 1px solid #e5e7eb;">Descrizione</th>
                        <th style="padding: 0.5rem; text-align: left; border: 1px solid #e5e7eb;">Condizione</th>
                        <th style="padding: 0.5rem; text-align: right; border: 1px solid #e5e7eb;">Prezzo</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="padding: 0.5rem; border: 1px solid #e5e7eb;">COMP-07</td>
                        <td style="padding: 0.5rem; border: 1px solid #e5e7eb;">Doppia Altezza</td>
                        <td style="padding: 0.5rem; border: 1px solid #e5e7eb;">Se H > 300cm</td>
                        <td style="padding: 0.5rem; text-align: right; border: 1px solid #e5e7eb; color: #dc2626; font-weight: 600;">‚Ç¨0.50/m</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div style="background: #fef3c7; border: 1px solid #fbbf24; border-radius: 0.5rem; padding: 1rem;">
            <h4 style="margin: 0 0 1rem 0; color: #92400e;">üß™ Test Calcolo Rapido</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 1rem; align-items: end;">
                <div>
                    <label style="display: block; margin-bottom: 0.25rem; font-weight: 600; color: #78350f;">Larghezza (cm):</label>
                    <input type="number" id="test-tapp-L" placeholder="es. 127.5" style="width: 100%; padding: 0.5rem; border: 1px solid #d97706; border-radius: 0.375rem;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 0.25rem; font-weight: 600; color: #78350f;">Altezza (cm):</label>
                    <input type="number" id="test-tapp-H" placeholder="es. 242.5" style="width: 100%; padding: 0.5rem; border: 1px solid #d97706; border-radius: 0.375rem;">
                </div>
                <div id="test-tapp-result" style="font-size: 1.25rem; font-weight: 700; color: #059669; text-align: center; padding: 0.5rem;">
                    -
                </div>
                <button onclick="testCalcoloTapparella()" style="padding: 0.5rem 1rem; background: #2563eb; color: white; border: none; border-radius: 0.375rem; cursor: pointer; font-weight: 600; white-space: nowrap;">
                    üßÆ Calcola
                </button>
            </div>
            <div id="test-tapp-dettaglio" style="margin-top: 1rem; padding: 0.75rem; background: white; border-radius: 0.375rem; font-size: 0.875rem; font-family: monospace; display: none;"></div>
        </div>
    </div>
    
    <div id="tab-content-zanzariere" class="tab-content-listini" style="display: none; padding: 1.5rem;">
        <h3 style="margin-bottom: 1rem; color: #1f2937;">üìä Listino Zanzariere</h3>
        <div id="listino-zanzariere-content"></div>
    </div>
    
    <div id="tab-content-test" class="tab-content-listini" style="display: none; padding: 1.5rem;">
        <h3 style="margin-bottom: 1rem; color: #1f2937;">üß™ Test Calcolo Rapido</h3>
        
        <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1.5rem;">
            <h4 style="margin-bottom: 1rem; color: #374151;">Persiana</h4>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1rem;">
                <div>
                    <label style="display: block; margin-bottom: 0.25rem; font-weight: 600; color: #4b5563;">Modello:</label>
                    <select id="test-modello" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;">
                        <option value="">Seleziona...</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 0.25rem; font-weight: 600; color: #4b5563;">Tipologia:</label>
                    <select id="test-tipologia" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;">
                        <option value="">Seleziona...</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 0.25rem; font-weight: 600; color: #4b5563;">Larghezza (mm):</label>
                    <input type="number" id="test-larghezza" placeholder="es. 1400" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 0.25rem; font-weight: 600; color: #4b5563;">Altezza (mm):</label>
                    <input type="number" id="test-altezza" placeholder="es. 1300" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 0.25rem; font-weight: 600; color: #4b5563;">Telaio:</label>
                    <select id="test-telaio" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;">
                        <option value="">Nessuno</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 0.25rem; font-weight: 600; color: #4b5563;">Colore:</label>
                    <select id="test-colore" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;">
                        <option value="">Nessuno</option>
                    </select>
                </div>
            </div>
            
            <button onclick="eseguiTestCalcolo()" style="width: 100%; padding: 0.75rem; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 0.5rem; font-weight: 600; cursor: pointer;">
                üßÆ Calcola Prezzo
            </button>
            
            <div id="test-risultato" style="margin-top: 1rem;"></div>
        </div>
    </div>
    
    <div class="preventivo-modal-actions">
        <button class="btn-preventivo btn-secondary" onclick="chiudiGestioneListini()">
            ‚Üê Chiudi
        </button>
    </div>
</div>
    </div>

    <div id="modal-prezzo-manuale" class="preventivo-modal-overlay" style="display: none;" onclick="if(event.target===this) chiudiModalPrezzoManuale()">
<div class="preventivo-modal" style="max-width: 600px;">
    <div class="preventivo-modal-header">
        <h2 class="preventivo-modal-title">‚ö†Ô∏è Inserimento Manuale Prezzo</h2>
        <button class="preventivo-modal-close" onclick="chiudiModalPrezzoManuale()">‚úï</button>
    </div>
    
    <div style="padding: 1.5rem;">
        <div style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 1rem; border-radius: 0.375rem; margin-bottom: 1.5rem;">
            <p style="margin: 0; color: #92400e; font-weight: 600;">
                üìè Dimensione non trovata nel listino
            </p>
            <p id="dimensione-mancante-info" style="margin: 0.5rem 0 0 0; color: #78350f; font-size: 0.875rem;"></p>
        </div>
        
        <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1.5rem;">
            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                    üí∞ Prezzo Base (‚Ç¨): *
                </label>
                <input type="number" id="input-prezzo-base-manuale" 
                       placeholder="es. 850.00" 
                       step="0.01"
                       style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 0.375rem; font-size: 1rem;">
            </div>
            
            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                    üõ†Ô∏è Prezzo Telaio (‚Ç¨):
                </label>
                <input type="number" id="input-telaio-manuale" 
                       placeholder="es. 136.00 (opzionale)" 
                       step="0.01"
                       style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 0.375rem; font-size: 1rem;">
            </div>
            
            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                    üé® Maggiorazione Colore (%):
                </label>
                <input type="number" id="input-colore-perc-manuale" 
                       placeholder="es. 30 (opzionale)" 
                       min="0" 
                       max="100"
                       style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 0.375rem; font-size: 1rem;">
            </div>
            
            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                    üìù Note:
                </label>
                <textarea id="input-note-manuale" 
                          placeholder="es. Prezzo da preventivo fornitore ABC del 15/11/2025" 
                          rows="3"
                          style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 0.375rem; font-size: 1rem; resize: vertical;"></textarea>
            </div>
            
            <div id="anteprima-calcolo-manuale" style="background: white; border: 2px solid #10b981; border-radius: 0.375rem; padding: 1rem; margin-top: 1rem; display: none;">
                <h4 style="margin: 0 0 0.75rem 0; color: #065f46;">üí° Anteprima Calcolo:</h4>
                <div style="display: grid; grid-template-columns: 1fr auto; gap: 0.5rem; font-size: 0.875rem;">
                    <div style="color: #6b7280;">Prezzo Base:</div>
                    <div id="preview-base" style="font-weight: 600; color: #1f2937;"></div>
                    
                    <div style="color: #6b7280;">Telaio:</div>
                    <div id="preview-telaio" style="font-weight: 600; color: #1f2937;"></div>
                    
                    <div style="padding-top: 0.5rem; border-top: 1px solid #e5e7eb; color: #6b7280;">Subtotale:</div>
                    <div id="preview-subtotale" style="padding-top: 0.5rem; border-top: 1px solid #e5e7eb; font-weight: 600; color: #1f2937;"></div>
                    
                    <div style="color: #6b7280;">Colore (%):</div>
                    <div id="preview-colore" style="font-weight: 600; color: #f59e0b;"></div>
                    
                    <div style="padding-top: 0.5rem; border-top: 1px solid #e5e7eb; color: #6b7280;">Totale Prodotto:</div>
                    <div id="preview-totale-prodotto" style="padding-top: 0.5rem; border-top: 1px solid #e5e7eb; font-weight: 700; color: #059669;"></div>
                    
                    <div style="color: #6b7280;">Contributo:</div>
                    <div id="preview-contributo" style="font-weight: 600; color: #1f2937;">‚Ç¨57.00</div>
                    
                    <div style="color: #6b7280;">Imballo (3%):</div>
                    <div id="preview-imballo" style="font-weight: 600; color: #1f2937;"></div>
                    
                    <div style="padding-top: 0.5rem; border-top: 2px solid #10b981; color: #065f46; font-weight: 700;">TOTALE FINALE:</div>
                    <div id="preview-finale" style="padding-top: 0.5rem; border-top: 2px solid #10b981; font-weight: 700; color: #059669; font-size: 1.125rem;"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="preventivo-modal-actions">
        <button class="btn-preventivo btn-secondary" onclick="chiudiModalPrezzoManuale()">
            Annulla
        </button>
        <button class="btn-preventivo btn-primary" onclick="calcolaAnteprimaManuale()" style="background: #3b82f6;">
            üßÆ Calcola Anteprima
        </button>
        <button id="btn-salva-prezzo-manuale" class="btn-preventivo btn-primary" onclick="salvaPrezzoManuale()" disabled style="opacity: 0.5;">
            ‚úÖ Salva Prezzo
        </button>
    </div>
</div>
    </div>

    <div id="modalDatiCliente" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 99999; justify-content: center; align-items: center;">
<div style="background: white; border-radius: 16px; max-width: 700px; width: 95%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
    <div style="background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%); color: white; padding: 1.5rem; border-radius: 16px 16px 0 0; display: flex; justify-content: space-between; align-items: center;">
        <h3 id="titoloModalDocumento" style="margin: 0; font-size: 1.3rem;">üìÑ Genera Documento</h3>
        <button onclick="window.chiudiModalDatiCliente()" style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; padding: 0; line-height: 1;">√ó</button>
    </div>
    
    <div id="stepSceltaTipo" style="padding: 1.5rem;">
        <p style="text-align: center; color: #6b7280; margin-bottom: 1.5rem;">Seleziona il tipo di documento da generare</p>
        
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
            <div onclick="window.selezionaTipoDocumento('preventivo_semplice')" 
                 style="border: 2px solid #e5e7eb; border-radius: 12px; padding: 1.5rem; text-align: center; cursor: pointer; transition: all 0.2s;"
                 onmouseover="this.style.borderColor='#8b5cf6'; this.style.background='#faf5ff';"
                 onmouseout="this.style.borderColor='#e5e7eb'; this.style.background='white';">
                <div style="font-size: 2.5rem; margin-bottom: 0.75rem;">üìã</div>
                <div style="font-weight: 700; color: #1f2937; margin-bottom: 0.5rem;">PREVENTIVO<br>SEMPLICE</div>
                <div style="font-size: 0.75rem; color: #6b7280; line-height: 1.4;">Tabella essenziale<br>con prezzi e totali</div>
            </div>
            
            <div onclick="window.selezionaTipoDocumento('preventivo_premium')" 
                 style="border: 2px solid #f59e0b; border-radius: 12px; padding: 1.5rem; text-align: center; cursor: pointer; transition: all 0.2s; background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); position: relative;"
                 onmouseover="this.style.transform='scale(1.02)';"
                 onmouseout="this.style.transform='scale(1)';">
                <div style="position: absolute; top: -8px; right: -8px; background: #f59e0b; color: white; font-size: 0.65rem; padding: 3px 8px; border-radius: 10px; font-weight: 700;">‚≠ê TOP</div>
                <div style="font-size: 2.5rem; margin-bottom: 0.75rem;">‚≠ê</div>
                <div style="font-weight: 700; color: #92400e; margin-bottom: 0.5rem;">PREVENTIVO<br>PREMIUM</div>
                <div style="font-size: 0.75rem; color: #78350f; line-height: 1.4;">Copertina + SVG<br>+ Servizi + Tecnologia</div>
            </div>
            
            <div onclick="window.selezionaTipoDocumento('conferma_premium')" 
                 style="border: 2px solid #e5e7eb; border-radius: 12px; padding: 1.5rem; text-align: center; cursor: pointer; transition: all 0.2s;"
                 onmouseover="this.style.borderColor='#10b981'; this.style.background='#ecfdf5';"
                 onmouseout="this.style.borderColor='#e5e7eb'; this.style.background='white';">
                <div style="font-size: 2.5rem; margin-bottom: 0.75rem;">‚úÖ</div>
                <div style="font-weight: 700; color: #1f2937; margin-bottom: 0.5rem;">CONFERMA<br>ORDINE</div>
                <div style="font-size: 0.75rem; color: #6b7280; line-height: 1.4;">Premium + Timeline<br>+ Pagamento</div>
            </div>
        </div>
    </div>
    
    <div id="stepDatiCliente" style="display: none; padding: 1.5rem;">
        <input type="hidden" id="tipoDocumentoCliente" value="">
        
        <button onclick="window.tornaSceltaTipo()" style="background: none; border: none; color: #6b7280; cursor: pointer; font-size: 0.9rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
            ‚Üê Cambia tipo documento
        </button>
        
        <div id="badgeTipoSelezionato" style="display: inline-block; padding: 0.5rem 1rem; border-radius: 20px; font-weight: 600; font-size: 0.85rem; margin-bottom: 1.5rem;"></div>
        
        <div style="margin-bottom: 1.5rem;">
            <h4 style="margin-bottom: 1rem; color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem;">
                üë§ Dati Cliente
            </h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div>
                    <label style="font-weight: 600; font-size: 0.85rem; color: #4b5563;">Nome e Cognome *</label>
                    <input type="text" id="clienteNome" placeholder="Mario Rossi" 
                           style="width: 100%; padding: 0.6rem; border: 1px solid #d1d5db; border-radius: 6px; margin-top: 0.25rem;">
                </div>
                <div>
                    <label style="font-weight: 600; font-size: 0.85rem; color: #4b5563;">Telefono</label>
                    <input type="text" id="clienteTelefono" placeholder="333 1234567" 
                           style="width: 100%; padding: 0.6rem; border: 1px solid #d1d5db; border-radius: 6px; margin-top: 0.25rem;">
                </div>
            </div>
            <div style="margin-top: 1rem;">
                <label style="font-weight: 600; font-size: 0.85rem; color: #4b5563;">Indirizzo Cantiere *</label>
                <input type="text" id="clienteIndirizzo" placeholder="Via Roma 1, Bergamo" 
                       style="width: 100%; padding: 0.6rem; border: 1px solid #d1d5db; border-radius: 6px; margin-top: 0.25rem;">
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                <div>
                    <label style="font-weight: 600; font-size: 0.85rem; color: #4b5563;">Email</label>
                    <input type="email" id="clienteEmail" placeholder="mario@email.it" 
                           style="width: 100%; padding: 0.6rem; border: 1px solid #d1d5db; border-radius: 6px; margin-top: 0.25rem;">
                </div>
                <div>
                    <label style="font-weight: 600; font-size: 0.85rem; color: #4b5563;">Codice Fiscale / P.IVA</label>
                    <input type="text" id="clienteCF" placeholder="RSSMRA80A01B157K" 
                           style="width: 100%; padding: 0.6rem; border: 1px solid #d1d5db; border-radius: 6px; margin-top: 0.25rem;">
                </div>
            </div>
        </div>
        
        <div style="margin-bottom: 1.5rem;">
            <h4 style="margin-bottom: 1rem; color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem;">
                üìã Riferimenti
            </h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div>
                    <label style="font-weight: 600; font-size: 0.85rem; color: #4b5563;">Numero Documento</label>
                    <input type="text" id="docNumero" placeholder="2025/001" 
                           style="width: 100%; padding: 0.6rem; border: 1px solid #d1d5db; border-radius: 6px; margin-top: 0.25rem;">
                </div>
                <div>
                    <label style="font-weight: 600; font-size: 0.85rem; color: #4b5563;">Data</label>
                    <input type="date" id="docData" 
                           style="width: 100%; padding: 0.6rem; border: 1px solid #d1d5db; border-radius: 6px; margin-top: 0.25rem;">
                </div>
            </div>
            <div style="margin-top: 1rem;">
                <label style="font-weight: 600; font-size: 0.85rem; color: #4b5563;">Oggetto / Descrizione Lavori</label>
                <input type="text" id="docOggetto" placeholder="Sostituzione serramenti appartamento" 
                       style="width: 100%; padding: 0.6rem; border: 1px solid #d1d5db; border-radius: 6px; margin-top: 0.25rem;">
            </div>
        </div>
        
        <div id="sezioneAccontoConferma" style="display: none; margin-bottom: 1.5rem;">
            <h4 style="margin-bottom: 1rem; color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem;">
                üí∞ Pagamento
            </h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div>
                    <label style="font-weight: 600; font-size: 0.85rem; color: #4b5563;">Acconto richiesto (%)</label>
                    <input type="number" id="accontoPct" value="30" min="0" max="100" 
                           style="width: 100%; padding: 0.6rem; border: 1px solid #d1d5db; border-radius: 6px; margin-top: 0.25rem;">
                </div>
                <div>
                    <label style="font-weight: 600; font-size: 0.85rem; color: #4b5563;">Tempi consegna stimati</label>
                    <input type="text" id="tempiConsegna" value="6-8 settimane" 
                           style="width: 100%; padding: 0.6rem; border: 1px solid #d1d5db; border-radius: 6px; margin-top: 0.25rem;">
                </div>
            </div>
        </div>
        
        <div>
            <label style="font-weight: 600; font-size: 0.85rem; color: #4b5563;">Note aggiuntive</label>
            <textarea id="docNote" rows="2" placeholder="Eventuali note..." 
                      style="width: 100%; padding: 0.6rem; border: 1px solid #d1d5db; border-radius: 6px; margin-top: 0.25rem; resize: vertical;"></textarea>
        </div>
    </div>
    
    <div id="footerDatiCliente" style="display: none; padding: 1rem 1.5rem; background: #f9fafb; border-top: 1px solid #e5e7eb; border-radius: 0 0 16px 16px; display: flex; justify-content: flex-end; gap: 1rem;">
        <button onclick="window.chiudiModalDatiCliente()" style="padding: 0.75rem 1.5rem; background: #e5e7eb; color: #374151; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
            Annulla
        </button>
        <button onclick="window.generaDocumentoFinale()" style="padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
            üìÑ Genera Documento
        </button>
    </div>
</div>
    </div>

    </div>

    <!-- Applicazione principale -->
    <script src="js/app.js"></script>
    
    <!-- üÜï v8.500: Project Manager Integration -->
    <script src="https://openporte2025.github.io/shared-database/pm-dashboard-integration.js"></script>
    
    
    <!-- Inizializzazione -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            updateDashboardVersion();
            console.log('üöÄ Dashboard Rilievi Modularizzato - Pronto!');
        });
    </script>
</body>
</html>
